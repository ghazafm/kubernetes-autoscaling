apiVersion: v1
kind: ConfigMap
metadata:
  name: flask-app-config
  namespace: default
  labels:
    app: flask-app
data:
  # Application settings
  APP_HOST: "0.0.0.0"
  APP_PORT: "5000"
  METRICS_PORT: "8000"
  DEBUG: "false"
  DEFAULT_SLEEP_TIME: "0.1"

  # Resource limits
  MAX_MEMORY_MB: "140"
  MAX_CPU_ITERATIONS: "500000"

  # ========================================
  # NEW: Memory Management Settings
  # ========================================

  # malloc_trim configuration (Linux only)
  # Forces glibc to release free memory back to OS
  USE_MALLOC_TRIM: "true"
  MALLOC_TRIM_INTERVAL: "30"  # seconds between automatic trim calls

  # Aggressive garbage collection
  # Runs GC across all generations (0, 1, 2) for thorough cleanup
  AGGRESSIVE_GC: "true"

  # ========================================
  # Cache Configuration (tuned for lower memory)
  # ========================================

  # Reduce cache size to minimize memory retention
  # Original: 5, Recommended: 2-3 for memory-constrained environments
  MEMORY_PRESSURE_CACHE_LIMIT: "3"

  # Reduce TTL for faster cache eviction
  # Original: 300 (5 minutes), New: 60 (1 minute)
  CACHE_ENTRY_TTL: "60"

  # Clean cache after shorter idle period
  # Original: 60, New: 30
  CACHE_IDLE_SECONDS: "30"

  # How often the background cleaner runs
  CLEAN_CHECK_INTERVAL: "10"

  # Default caching behavior for /api/memory endpoint
  # Set to "false" to disable caching by default (better for testing)
  CACHE_DEFAULT: "true"