apiVersion: v1
kind: ConfigMap
metadata:
  name: test-flask-app-config
  namespace: default
  labels:
    app: test-flask-app
data:
  # Application settings
  APP_HOST: "0.0.0.0"
  APP_PORT: "5000"
  METRICS_PORT: "8000"
  DEBUG: "false"
  DEFAULT_SLEEP_TIME: "0.1"

  # Resource limits
  MAX_MEMORY_MB: "140"
  MAX_CPU_ITERATIONS: "500000"

  # ========================================
  # HPA test MODE - Sustained Memory Load
  # ========================================

  # INCREASE cache size for more memory retention
  MEMORY_PRESSURE_CACHE_LIMIT: "13"  # Was 3, now 10 for HPA test

  # INCREASE TTL to keep memory allocated longer
  CACHE_ENTRY_TTL: "600"  # 10 minutes (was 60s)

  # INCREASE idle seconds before cleanup
  CACHE_IDLE_SECONDS: "300"  # 5 minutes (was 30s)

  # SLOW DOWN automatic cleanup
  CLEAN_CHECK_INTERVAL: "60"  # Every 60s (was 10s)

  # Default caching ON for sustained load
  CACHE_DEFAULT: "true"

  # ========================================
  # Memory Management Settings (Adjusted for HPA)
  # ========================================

  # SLOW DOWN malloc_trim for sustained memory
  USE_MALLOC_TRIM: "true"
  MALLOC_TRIM_INTERVAL: "300"  # 5 minutes (was 180s)

  # Keep aggressive GC but less frequent
  AGGRESSIVE_GC: "false"  # Turn OFF for slower cleanup

  # CRITICAL: Keep PYTHONMALLOC=malloc for when cleanup DOES happen
  PYTHONMALLOC: "malloc"